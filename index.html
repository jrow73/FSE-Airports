<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Worldwide Airports Map</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />

  <style>
    body, html { margin:0; padding:0; height:100%; }
    #map { width:100%; height:100vh; }

    /* Legend styles */
    .legend {
      background: white;
      padding: 10px;
      line-height: 1.5em;
      font-size: 14px;
      box-shadow: 0 0 6px rgba(0,0,0,0.3);
      border-radius: 6px;
    }
    .legend div {
      display:flex;
      align-items:center;
    }
    .legend span {
      display:inline-block;
      width:12px; height:12px;
      margin-right:6px;
      opacity:0.8;
    }
  </style>
</head>
<body>
  <div id="map"></div>

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

  <script>
    let map;
    let markersLayer = L.layerGroup();
    let allData = [];

    function initMap() {
      map = L.map('map').setView([20,0], 2);

      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
        attribution: '&copy; OpenStreetMap contributors'
      }).addTo(map);

      markersLayer.addTo(map);
      addLegend();
      loadData();
    }

    // Fetch airports JSON from GitHub
    function loadData() {
      const dataUrl = 'https://raw.githubusercontent.com/jrow73/FSE-Airports/refs/heads/main/airports.json';

      fetch(dataUrl)
        .then(res => {
          if (!res.ok) throw new Error(`HTTP error! status: ${res.status}`);
          return res.json();
        })
        .then(data => {
          console.log('Fetched data:', data.slice(0,5));
          allData = data;
          renderMarkers(allData);
        })
        .catch(err => console.error('Error fetching JSON data:', err));
    }

    function renderMarkers(data) {
      markersLayer.clearLayers();
      data.forEach(a => {
        if (!a.lat || !a.lon) return;

        const type = (a.type || '').toLowerCase();
        const size = Number(a.size || 0);

        // Marker colors
        const color = type==='military' ? 'red' :
                      type==='water' ? 'blue' : 'green';
        // Marker shapes
        const shape = size >= 3500 ? 'star' :
                      size >= 1000 ? 'square' : 'circle';

        const icon = L.divIcon({
          html: `<div style="
                  background:${color};
                  width:${shape==='star'?16:10}px;
                  height:${shape==='star'?16:10}px;
                  border-radius:${shape==='circle'?'50%':'0'};
                  transform:${shape==='star'?'rotate(45deg)':''};
                  opacity:0.8;">
                 </div>`,
          iconSize: [10,10],
          className: ''
        });

        const popup = `
          <b>${a.name || ''}</b><br>
          ${a.city || ''}, ${a.state || ''}<br>
          ${a.country || ''}<br>
          Type: ${a.type || ''}<br>
          Size: ${a.size || ''}<br>
          Elev: ${a.elev || ''} ft<br>
          Surface: ${a.surfaceType || ''}<br>
          Longest RWY: ${a.longestRwy || ''}<br>
          Services: ${a.services || ''}
        `;

        L.marker([a.lat, a.lon], {icon}).bindPopup(popup).addTo(markersLayer);
      });
    }

    function addLegend() {
      const legend = L.control({position: 'bottomright'});

      legend.onAdd = function() {
        const div = L.DomUtil.create('div', 'legend');
        div.innerHTML += '<b>Type & Size</b><br>';
        const types = {civil:'green', water:'blue', military:'red'};
        const sizes = ['small','medium','large'];
        for (const t in types) {
          for (const s of sizes) {
            const shape = s==='large' ? '★' : s==='medium' ? '■' : '●';
            div.innerHTML += `<div><span style="background:${types[t]};">${shape}</span>${t} ${s}</div>`;
          }
        }
        return div;
      };

      legend.addTo(map);
    }

    document.addEventListener('DOMContentLoaded', initMap);
  </script>
</body>
</html>
