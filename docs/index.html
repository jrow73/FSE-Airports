<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>FSE Airport Map Viewer</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin="" />
  <link rel="stylesheet" href="./css/styles.css" />
</head>
<body>
  <div id="app">
    <!-- Top header bar -->
    <header class="topbar">
      <div class="top-left">
        <span class="app-title">Airports</span>
        <span id="loading" class="loading hidden">Loading…</span>
      </div>

      <div class="top-center">
        <div class="search-wrap">
          <input
            id="searchInput"
            class="search"
            type="search"
            placeholder="Search ICAO, Airport Name, City, or lat/lon (Press Enter)"
            autocomplete="off"
          />
        </div>
      </div>

      <div class="top-right">
        <button id="filtersBtn" class="menu-btn" aria-expanded="false">Filters ▾</button>
        <button id="distanceBtn" class="menu-btn" aria-expanded="false">Distance ▾</button>
      </div>
    </header>

    <!-- Slide-down filters panel -->
    <section id="filtersPanel" class="panel" aria-hidden="true">
      <div class="panel-inner">

        <!-- Regional filters -->
        <div class="filter-section">
          <button
            type="button"
            class="filter-section-header"
            aria-expanded="true"
          >
            <span>Regional filters</span>
            <span class="filter-section-header-icon">▾</span>
          </button>
          <div class="filter-section-body">
            <div class="grid filters-grid">

              <!-- Country -->
              <div class="field field-tall">
                <label for="countrySelect">Country</label>
                <select id="countrySelect" multiple size="20">
                  <option value="">All</option>
                </select>
              </div>

              <!-- State -->
              <div class="field field-tall">
                <label for="stateSelect">State</label>
                <select id="stateSelect" multiple size="20">
                  <option value="">All</option>
                </select>
              </div>

              <!-- Radius -->
              <div class="field field-compact">
                <label class="inline-label" for="radiusCenter">Radius center / (nm)</label>
                <div class="inline-group">
                  <input
                    id="radiusCenter"
                    type="text"
                    autocomplete="off"
                    placeholder="ICAO or lat/lon"
                  />
                  <input
                    id="radiusNm"
                    type="number"
                    inputmode="numeric"
                    min="1"
                    step="10"
                    placeholder="nm"
                  />
                </div>
              </div>

            </div>
          </div>
        </div>

        <!-- Runway filters -->
        <div class="filter-section">
          <button
            type="button"
            class="filter-section-header"
            aria-expanded="true"
          >
            <span>Runway filters</span>
            <span class="filter-section-header-icon">▾</span>
          </button>
          <div class="filter-section-body">
            <div class="grid filters-grid">

              <!-- Runway length -->
              <div class="field field-compact">
                <label>Runway (ft)</label>
                <div class="inline-group">
                  <input
                    id="rwyMin"
                    type="number"
                    inputmode="numeric"
                    min="0"
                    step="500"
                    placeholder="Min"
                  />
                  <span class="inline-separator">/</span>
                  <input
                    id="rwyMax"
                    type="number"
                    inputmode="numeric"
                    min="0"
                    step="500"
                    placeholder="Max"
                  />
                </div>
              </div>

              <!-- Surface type -->
              <div class="field field-compact">
                <label for="surfaceSelect" class="stack-label">Surface Type</label>
                <select id="surfaceSelect" multiple size="6">
                  <option value="">All</option>
                </select>
              </div>

            </div>
          </div>
        </div>

        <!-- Airport features -->
        <div class="filter-section">
          <button
            type="button"
            class="filter-section-header"
            aria-expanded="true"
          >
            <span>Airport features</span>
            <span class="filter-section-header-icon">▾</span>
          </button>
          <div class="filter-section-body">
            <div class="grid filters-grid">

              <!-- Type -->
              <div class="field field-compact">
                <label for="typeSelect">Type</label>
                <select id="typeSelect" multiple size="4">
                  <option value="">All</option>
                  <option value="civil">Civil</option>
                  <option value="military">Military</option>
                  <option value="water">Water</option>
                </select>
              </div>

              <!-- Size -->
              <div class="field field-compact">
                <label for="sizeSelect" class="stack-label">Size</label>
                <select id="sizeSelect" multiple size="4">
                  <option value="">All</option>
                  <option value="small">Small</option>
                  <option value="medium">Medium</option>
                  <option value="large">Large</option>
                </select>
              </div>

              <!-- IRL / Local services -->
              <div class="field field-compact">
                <label for="irlStatus" class="stack-label">IRL airport</label>
                <select id="irlStatus" multiple size="4">
                  <option value="any">Any</option>
                  <option value="correct">FSE ICAO = IRL ICAO</option>
                  <option value="incorrect">FSE ICAO ≠ IRL ICAO</option>
                  <option value="none">No IRL airport</option>
                </select>

                <label class="stack-label">Local services</label>
                <div class="inline-group">
                  <label class="inline">
                    <input type="checkbox" id="localFuel" />
                    Fuel
                  </label>
                  <label class="inline">
                    <input type="checkbox" id="localMx" />
                    Maintenance
                  </label>
                </div>
              </div>

            </div>
          </div>
        </div>

        <div class="panel-actions">
          <div class="panel-count">
            <div id="count" class="count"></div>
            <button id="copyIcaos" class="ghost copy-btn" disabled>Copy ICAOs</button>
          </div>
          <div class="panel-buttons">
            <button id="filtersClear" class="ghost">Clear All</button>
            <button id="filtersClose">Show Map</button>
          </div>
        </div>
      </div>
    </section>

    <!-- Distance panel -->
    <section id="distancePanel" class="panel" aria-hidden="true">
      <div class="panel-inner">
        <div class="grid">
          <div class="field">
            <label for="distFrom">From ICAO</label>
            <input
              id="distFrom"
              type="text"
              maxlength="32"
              autocomplete="off"
              placeholder="ICAO or lat lon"
            />
          </div>

          <div class="field">
            <label for="distTo">To ICAO</label>
            <input
              id="distTo"
              type="text"
              maxlength="32"
              autocomplete="off"
              placeholder="ICAO or lat lon"
            />
          </div>
        </div>

        <div class="panel-actions">
          <div id="distanceResult" class="count"></div>
          <div class="panel-buttons">
            <button id="distanceGo">Compute</button>
            <button id="distanceSwap" class="ghost">Swap</button>
            <button id="distanceClear" class="ghost">Clear</button>
            <button id="distanceClose">Close</button>
          </div>
        </div>
      </div>
    </section>

    <!-- Map fills the rest -->
    <main id="map"></main>

    <!-- Map legend (bottom-left overlay) -->
    <div id="mapLegend" class="map-legend"></div>

    <!-- ===================== SUGGESTION MODALS ====================== -->

    <!-- Change existing airport modal -->
    <div id="changeModal" class="suggest-modal hidden" aria-hidden="true">
      <div class="suggest-modal-backdrop" data-modal-close></div>
      <div class="suggest-modal-dialog">
        <button type="button" class="suggest-modal-close" data-modal-close>&times;</button>

        <h2 class="suggest-modal-title">Suggest changes to the FSE airport at this map position</h2>
        <p id="change-airport-summary"></p>
        <hr />
        <p class="suggest-note">
          NOTE: If there is no IRL airport at all at this map position
          <br />
          <strong>BUT</strong> the IRL ICAO in the table below has a value assigned,
          <br />
          propose the IRL ICAO as “XXXX” to indicate that the FSE airport is closed.
        </p>
        <hr /><br />

        <form id="change-form">
          <input type="hidden" name="type" value="change" />
          <input type="hidden" id="icao-input" name="icao" />
          <input type="hidden" name="source" value="FSE Map Viewer" />

          <div class="suggest-grid">
            <div class="suggest-grid-header">Field Name</div>
            <div class="suggest-grid-header">Current Value</div>
            <div class="suggest-grid-header">Proposed Value</div>

            <!-- IRL ICAO -->
            <div class="suggest-label">IRL ICAO (real-world)</div>
            <div class="suggest-current-value" id="cur-icao"></div>
            <div>
              <input
                type="text"
                name="proposed_icao"
                id="proposed_icao"
                placeholder="What is the correct IRL ICAO at this map position?"
                maxlength="4"
              />
            </div>

            <!-- Name -->
            <div class="suggest-label">Name</div>
            <div class="suggest-current-value" id="cur-name"></div>
            <div>
              <input
                type="text"
                name="proposed_name"
                id="proposed_name"
                placeholder="What is the correct name"
              />
            </div>

            <!-- City -->
            <div class="suggest-label">City</div>
            <div class="suggest-current-value" id="cur-city"></div>
            <div>
              <input
                type="text"
                name="proposed_city"
                id="proposed_city"
                placeholder="What is the correct city"
              />
            </div>

            <!-- State -->
            <div class="suggest-label">State</div>
            <div class="suggest-current-value" id="cur-state"></div>
            <div>
              <input
                type="text"
                name="proposed_state"
                id="proposed_state"
                placeholder="What is the correct state/province"
              />
            </div>

            <!-- Country -->
            <div class="suggest-label">Country</div>
            <div class="suggest-current-value" id="cur-country"></div>
            <div>
              <input
                type="text"
                name="proposed_country"
                id="proposed_country"
                placeholder="What is the correct country"
              />
            </div>

            <!-- Elevation -->
            <div class="suggest-label">Elevation (ft)</div>
            <div class="suggest-current-value" id="cur-elev"></div>
            <div>
              <input
                type="text"
                name="proposed_elev"
                id="proposed_elev"
                placeholder="What is the correct elevation"
                maxlength="5"
              />
            </div>

            <!-- Longest runway -->
            <div class="suggest-label">Longest runway (ft)</div>
            <div class="suggest-current-value" id="cur-longest"></div>
            <div>
              <input
                type="text"
                name="proposed_longest"
                id="proposed_longest"
                placeholder="What is the correct length"
                maxlength="5"
              />
            </div>

            <!-- Surface type -->
            <div class="suggest-label">Surface type</div>
            <div class="suggest-current-value" id="cur-surface"></div>
            <div>
              <select name="proposed_surface" id="proposed_surface">
                <option value="">(no change)</option>
                <option>Asphalt</option>
                <option>Concrete</option>
                <option>Coral</option>
                <option>Dirt</option>
                <option>Grass</option>
                <option>Gravel</option>
                <option>Helipad</option>
                <option>Oil Treated</option>
                <option>Snow</option>
                <option>Steel Mats</option>
                <option>Water</option>
              </select>
            </div>

            <!-- Airport type -->
            <div class="suggest-label">Airport type</div>
            <div class="suggest-current-value" id="cur-airportType"></div>
            <div>
              <select name="proposed_airportType" id="proposed_airportType">
                <option value="">(no change)</option>
                <option value="Civil">Civil</option>
                <option value="Water">Water</option>
                <option value="Military">Military</option>
              </select>
            </div>
          </div>

          <div style="margin-top:1rem;">
            <label for="change-comments"><strong>Additional comments</strong></label>
            <textarea
              id="change-comments"
              name="comments"
              placeholder="Anything else we should know? Is there a source website we can use to verify this suggestion?"
              maxlength="255"
            ></textarea>
            <div
              id="change-comment-counter"
              style="font-size:0.75rem; color:#6b7280; margin-top:2px;"
            >
              0 / 255
            </div>
          </div>

          <div class="suggest-buttons">
            <button type="submit" class="suggest-btn-primary" id="change-submit-btn">
              Submit suggestion
            </button>
            <button type="button" class="suggest-btn-secondary" data-modal-close>
              Close
            </button>
          </div>

          <div id="change-submit-hint" class="suggest-submit-hint"></div>
          <div id="change-status" class="suggest-status"></div>
        </form>
      </div>
    </div>

    <!-- New airport modal -->
    <div id="newModal" class="suggest-modal hidden" aria-hidden="true">
      <div class="suggest-modal-backdrop" data-modal-close></div>
      <div class="suggest-modal-dialog">
        <button type="button" class="suggest-modal-close" data-modal-close>&times;</button>

        <h2 class="suggest-modal-title">Suggest a new airport</h2>
        <p class="suggest-note">
          The latitude/longitude below comes from the pin you placed on the map and cannot be changed.
          If the pin was not exact, please go back to the map and start from a new pin in the correct
          location.
        </p>

<form id="new-airport-form">
  <input type="hidden" name="type" value="new" />

  <div class="suggest-form-grid">
    <div class="suggest-form-label">
      <label for="new-icao">ICAO <span class="suggest-required">*</span></label>
    </div>
    <div class="suggest-form-control">
      <input
        type="text"
        id="new-icao"
        name="icao"
        placeholder="e.g. KABC"
        maxlength="4"
        required
      />
    </div>

    <div class="suggest-form-label">
      <label for="new-name">Airport name <span class="suggest-required">*</span></label>
    </div>
    <div class="suggest-form-control">
      <input
        type="text"
        id="new-name"
        name="name"
        placeholder="Airport name"
        required
      />
    </div>

    <div class="suggest-form-label">
      <label for="new-city">City <span class="suggest-required">*</span></label>
    </div>
    <div class="suggest-form-control">
      <input
        type="text"
        id="new-city"
        name="city"
        placeholder="City"
        required
      />
    </div>

    <div class="suggest-form-label">
      <label for="new-state">State / Province / Territory</label>
    </div>
    <div class="suggest-form-control suggest-form-control--with-status">
      <input
        type="text"
        id="new-state"
        name="state"
        placeholder="(if applicable) [USA, CAN, AUS only]"
        list="new-state-list"
      />
      <span
        id="new-state-valid"
        class="field-valid-indicator"
        aria-hidden="true"
      >
        ✓
      </span>
    </div>


    <div class="suggest-form-label">
      <label for="new-country">Country <span class="suggest-required">*</span></label>
    </div>
    <div class="suggest-form-control suggest-form-control--with-status">
      <input
        type="text"
        id="new-country"
        name="country"
        placeholder="Country"
        required
        list="new-country-list"
      />
      <span
        id="new-country-valid"
        class="field-valid-indicator"
        aria-hidden="true"
      >
        ✓
      </span>
    </div>


    <div class="suggest-form-label">
      <label for="new-elev">Elevation (ft) <span class="suggest-required">*</span></label>
    </div>
    <div class="suggest-form-control">
      <input
        type="text"
        id="new-elev"
        name="elev"
        placeholder="e.g. 1234, numbers only"
        maxlength="5"
        required
      />
    </div>

    <div class="suggest-form-label">
      <label for="new-longestRwy">
        Longest runway (ft) <span class="suggest-required">*</span>
      </label>
    </div>
    <div class="suggest-form-control">
      <input
        type="text"
        id="new-longestRwy"
        name="longestRwy"
        placeholder="e.g. 4500, numbers only"
        maxlength="5"
        required
      />
    </div>

    <div class="suggest-form-label">
      <label for="new-surfaceType">
        Surface type <span class="suggest-required">*</span>
      </label>
    </div>
    <div class="suggest-form-control">
      <select id="new-surfaceType" name="surfaceType" required>
        <option value="">(select surface type)</option>
        <option>Asphalt</option>
        <option>Concrete</option>
        <option>Coral</option>
        <option>Dirt</option>
        <option>Grass</option>
        <option>Gravel</option>
        <option>Helipad</option>
        <option>Oil Treated</option>
        <option>Snow</option>
        <option>Steel Mats</option>
        <option>Water</option>
      </select>
    </div>

    <div class="suggest-form-label">
      <label for="new-airportType">
        Airport type <span class="suggest-required">*</span>
      </label>
    </div>
    <div class="suggest-form-control">
      <select id="new-airportType" name="airportType" required>
        <option value="">(select airport type)</option>
        <option value="Civil">Civil</option>
        <option value="Water">Water</option>
        <option value="Military">Military</option>
      </select>
    </div>

    <div class="suggest-form-label">
      <label for="new-lat">Latitude <span class="suggest-required">*</span></label>
    </div>
    <div class="suggest-form-control">
      <input type="text" id="new-lat" name="lat" readonly />
    </div>

    <div class="suggest-form-label">
      <label for="new-lon">Longitude <span class="suggest-required">*</span></label>
    </div>
    <div class="suggest-form-control">
      <input type="text" id="new-lon" name="lon" readonly />
    </div>

    <div class="suggest-form-label">
      <label for="new-comments">
        Additional comments <span class="suggest-required">*</span>
      </label>
    </div>
    <div class="suggest-form-control">
      <textarea
        id="new-comments"
        name="comments"
        placeholder="Any other details (runway type/length, notes, etc.)"
        maxlength="255"
        required
      ></textarea>
      <div
        id="new-comment-counter"
        style="font-size:0.75rem; color:#6b7280; margin-top:2px;"
      >
        0 / 255
      </div>
    </div>
  </div>

  <datalist id="new-state-list"></datalist>
  <datalist id="new-country-list"></datalist>

  <div class="suggest-buttons">
    <button type="submit" class="suggest-btn-primary">
      Submit new airport
    </button>
    <button type="button" class="suggest-btn-secondary" data-modal-close>
      Close
    </button>
  </div>

  <div id="new-status" class="suggest-status"></div>
</form>
      </div>
    </div>
  </div>

  <!-- Leaflet core -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>

  <!-- Leaflet.glify browser build -->
  <script src="https://cdn.jsdelivr.net/npm/leaflet.glify@3.3.1/dist/glify-browser.js"></script>

  <!-- local app modules -->
  <script src="./js/map.js"></script>
  <script src="./js/gl-renderer.js"></script>
  <script src="./js/search.js"></script>
  <script src="./js/geo-utils.js"></script>
  <script src="./js/query-ui.js"></script>
  <script src="./js/distance-tool.js"></script>

  <!-- NEW: suggestion modal logic -->
  <script src="./js/suggestion-forms.js"></script>

  <script src="./js/app.js"></script>
</body>
</html>
